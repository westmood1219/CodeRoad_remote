/*********************************************************************************************************
* 模块名称: Main.c
* 摘    要: 主文件，包含初始化函数和main函数
* 当前版本: 1.0.0
* 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
* 完成日期: 2022年2月1日
* 内    容: 
* 注    意: 
**********************************************************************************************************
* 取代版本: 
* 作    者: 
* 完成日期: 
* 修改内容: 
* 修改文件: 
*********************************************************************************************************/
/*********************************************************************************************************
*                                              包含头文件
*********************************************************************************************************/
#include <reg52.h>

/*********************************************************************************************************
*                                              宏定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              枚举结构体定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部变量
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部函数声明
*********************************************************************************************************/
static void InitInterrupt(void);
static void InitUART(void);

/*********************************************************************************************************
*                                              内部函数实现
*********************************************************************************************************/
/*********************************************************************************************************
* 函数名称: InitInterrupt
* 函数功能: 中断初始化
* 输入参数: void
* 输出参数: void
* 返 回 值: void
* 创建日期: 2022年2月1日
* 注    意: 
*********************************************************************************************************/
static void InitInterrupt()
{     
  ES = 1;         //打开 串口接受中断允许
  EA = 1;         //打开 总中断允许
}

/*********************************************************************************************************
* 函数名称: InitUART
* 函数功能: 串口初始化
* 输入参数: void
* 输出参数: void
* 返 回 值: void
* 创建日期: 2022年2月1日
* 注    意: 
*********************************************************************************************************/
static void InitUART()
{
  SCON = 0X50;           //设置 串口 工作模式1，并打开接收允许
  TMOD = 0X20;           //设置 定时器1 工作模式2（8位自动重装定时器）
  PCON = 0X80;           //设置 波特率加倍
  TL1  = 0XF3;           //设置 定时器1 计数初值，波特率为4800
  TH1  = TL1;            //设置 定时器1重装载值，等于计数初值
  TR1  = 1;              //打开 定时器1
}

/*********************************************************************************************************
* 函数名称: main
* 函数功能: 主函数
* 输入参数: void
* 输出参数: void
* 返 回 值: void
* 创建日期: 2022年2月1日
* 注    意: 
*********************************************************************************************************/
void main()
{
  InitInterrupt();    //初始化中断
  InitUART();         //初始化串口
  while (1)
  {
    
  }
}

/*********************************************************************************************************
* 函数名称: UART_Handler
* 函数功能: 串口中断服务函数
* 输入参数: void
* 输出参数: void
* 返 回 值: void
* 创建日期: 2022年2月1日
* 注    意: 
*********************************************************************************************************/
void UART_Handler() interrupt 4
{
  static unsigned char s_iBuffer;   //定义临时缓冲变量
  s_iBuffer = SBUF;                 //将数据从串口数据缓冲寄存器中取出
  RI = 0;                           //清除接收中断标志位

  SBUF = s_iBuffer;                 //将数据放入串口数据缓冲寄存器
  while(!TI)                        //等待发送数据完成
  {
    
  }
  TI = 0;                           //清除发送完成标志位
}
