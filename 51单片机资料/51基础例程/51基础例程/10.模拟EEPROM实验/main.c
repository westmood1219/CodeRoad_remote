/*********************************************************************************************************
* 模块名称: Main.c
* 摘    要: 主文件，包含初始化函数和main函数
* 当前版本: 1.0.0
* 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
* 完成日期: 2022年2月1日
* 内    容: 
* 注    意: 
**********************************************************************************************************
* 取代版本: 
* 作    者: 
* 完成日期: 
* 修改内容: 
* 修改文件: 
*********************************************************************************************************/
/*********************************************************************************************************
*                                              包含头文件
*********************************************************************************************************/
#include <reg52.h>
#include <EEPROM.h>

/*********************************************************************************************************
*                                              宏定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              位定义
*********************************************************************************************************/
sbit LED1 = P2 ^ 4;    //位定义LED1
sbit LED2 = P2 ^ 5;    //位定义LED2
sbit LED3 = P2 ^ 6;    //位定义LED3
sbit KEY1 = P3 ^ 2;    //位定义KEY1
sbit KEY2 = P3 ^ 3;    //位定义KEY2
sbit KEY3 = P3 ^ 4;    //位定义KEY3

/*********************************************************************************************************
*                                              枚举结构体定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部变量
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部函数声明
*********************************************************************************************************/
static void DelayNms(int nms);

/*********************************************************************************************************
*                                              内部函数实现
*********************************************************************************************************/

/*********************************************************************************************************
* 函数名称: DelayNms
* 函数功能: 软件延迟函数，用于延迟一段时间
* 输入参数: xms-延迟时间（毫秒）
* 输出参数: void
* 返 回 值: void
* 创建日期: 2022年2月1日
* 注    意: 
*********************************************************************************************************/
static void DelayNms(int nms)
{
  unsigned int i,j;
  for(i = 0; i < nms; i++)
  {
    for(j = 0; j < 123; j++)
    {
      
    } 
  }
}

/*********************************************************************************************************
* 函数名称: main
* 函数功能: 主函数
* 输入参数: void
* 输出参数: void
* 返 回 值: void
* 创建日期: 2022年2月1日
* 注    意: 
*********************************************************************************************************/
void main()
{
  P2 = IAPByteRead(0x2000);               //读取起始地址为0x2000的扇区中的值，赋值给P2寄存器，恢复LED灯状态
  while(1)  
  {
    if(0 == KEY1)                         //第一次检测到KEY1按键被按下
    {
      DelayNms(50);                       //等待约50ms后再次检测按键是否被按下，消除按键抖动带来的影响
      if(0 == KEY1)                       //第二次检测到KEY1按键被按下
      {
        LED1 = ~LED1;                     //对LED1状态取反，改变LED1的亮灭状态
        while(0 == KEY1);                 //等待按键弹起  
        IAPSectorErase(0x2000);           //擦除起始地址为0x2000的扇区
        IAPByteWrite(0x2000,P2);          //对起始地址为0x2000的扇区写入P2寄存器的值
      }
    }

    if(0 == KEY2)                         //第一次检测到KEY2按键被按下
    {                       
      DelayNms(50);                       //等待约50ms后再次检测按键是否被按下，消除按键抖动带来的影响
      if(0 == KEY2)                       //第二次检测到KEY2按键被按下
      {
        LED2 = ~LED2;                     //对LED2状态取反，改变LED2的亮灭状态
        while(0 == KEY2);                 //等待按键弹起
        IAPSectorErase(0x2000);           //擦除起始地址为0x2000的扇区
        IAPByteWrite(0x2000,P2);          //对起始地址为0x2000的扇区写入P2寄存器的值
      }
    }

    if(0 == KEY3)                         //第一次检测到KEY3按键被按下
    {
      DelayNms(50);                       //等待约50ms后再次检测按键是否被按下，消除按键抖动带来的影响
      if(0 == KEY3)                       //第二次检测到KEY3按键被按下
      {
        LED3 = ~LED3;                     //改变LED3的开关状态
        while(0 == KEY3);                 //等待按键弹起 
        IAPSectorErase(0x2000);           //擦除起始地址为0x2000的扇区
        IAPByteWrite(0x2000,P2);          //对起始地址为0x2000的扇区写入P2寄存器的值
      }
    }
  }
}
